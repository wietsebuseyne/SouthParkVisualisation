<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
    <title>South Park Text Analysis</title>
    <style>

    </style>
    <script src="d3.v3.min.js"></script>
    <script src="cloud.min.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      var fill = d3.scale.category20();

      var rotations = [-60, -30, 0, 30, 60]

      var width = 400, height = 400;

      var drawWordle = function(tsvFile) {
        d3.tsv(tsvFile,
          function(d) {
            return {
              text: d.word,
              count: +d.count
            };
          },
          //TODO sort data: biggest count on top to ensure that they are showed
          function(error, data) {
            var sizeScale = d3.scale.log()
              .domain([1, d3.max(data, function(d) { return d.count;})])
              .range([20,60]);
            var layout = d3.layout.cloud()
                .size([width, height])
                .words(data)
                .padding(5)
                .rotate(function() { return rotations[~~(Math.random() * rotations.length)]; })
                .font("Impact")
                .fontSize(function(d) { return sizeScale(d.count); })
                .on("end", draw);

            layout.start();
          });
      }

      function draw(words) {
        d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
          .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
          .selectAll("text")
            .data(words)
          .enter().append("text")
            .style("font-size", function(d) { return d.size + "px"; })
            .style("font-family", "Impact")
            .style("fill", function(d, i) { return fill(i); })
            .attr("text-anchor", "middle")
            .attr("transform", function(d) {
              return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
            })
            .text(function(d) { return d.text; });
      }

      var drawSingle = function(i, max) {
        if(i <= max)
          setTimeout(function(){
            drawWordle("episodeData/" + i + "_profanities.tsv");
            drawSingle(++i, max);
          }, 1000);
      }

      drawSingle(1, 257)
        
    </script>
  </body>
</html>
